{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            <h2 class="mb-4">Searching for the perfect recipes...</h2>

            <!-- Progress Bar -->
            <div class="progress mb-4" style="height: 25px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                    style="width: 0%" id="searchProgress">
                </div>
            </div>

            <!-- Fun Messages -->
            <div class="card mb-4">
                <div class="card-body">
                    <p class="mb-0" id="funMessage">
                        Digging through the internet for the best recipes...
                    </p>
                </div>
            </div>

            <!-- Estimated Time -->
            <p class="text-muted">
                Estimated time remaining: <span id="timeRemaining">2 minutes</span>
            </p>
        </div>
    </div>
</div>

<!-- JavaScript for progress updates -->
<script>
    const funMessages = [
        "Digging through the internet for the best recipes...",
        "Organizing the internet's culinary wisdom...",
        "Filtering out influencer comments...",
        "Checking r/ididnthaveeggs for recipe modifications...",
        "Making sure r/iamveryculinary approves...",
        "Consulting with Gordon Ramsay's digital ghost...",
        "Measuring ingredients with digital precision...",
        "Converting grandma's 'a pinch of this' to exact measurements...",
        "Fact-checking against ancient cookbooks...",
        "Making sure the recipe doesn't call for 'love' as an ingredient..."
    ];

    let progress = 0;
    let messageIndex = 0;
    const totalTime = 120; // 2 minutes in seconds
    let timeRemaining = totalTime;

    function updateProgress() {
        progress += 1;
        if (progress > 100) progress = 100;

        // Update progress bar
        document.getElementById('searchProgress').style.width = `${progress}%`;

        // Update time remaining
        timeRemaining = Math.max(0, totalTime - (progress * totalTime / 100));
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = Math.floor(timeRemaining % 60);
        document.getElementById('timeRemaining').textContent =
            `${minutes}:${seconds.toString().padStart(2, '0')}`;

        // Update fun message every 10 seconds
        if (progress % 10 === 0) {
            messageIndex = (messageIndex + 1) % funMessages.length;
            document.getElementById('funMessage').textContent = funMessages[messageIndex];
        }

        // Check if search is complete
        fetch('/check_search_status')
            .then(response => response.json())
            .then(data => {
                if (data.complete) {
                    window.location.href = data.redirect_url;
                } else if (progress < 100) {
                    setTimeout(updateProgress, 1000);
                }
            })
            .catch(error => {
                console.error('Error checking search status:', error);
                setTimeout(updateProgress, 1000);
            });
    }

    // Start the progress updates
    updateProgress();
</script>
{% endblock %}